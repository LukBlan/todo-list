(()=>{"use strict";const e={};function t(t,o){e[t]=e[t]||[],e[t].push(o)}function o(t,o){e[t].forEach((e=>e(o)))}t("newProject",(function(){a.replaceChild(r,n)}));const n=function(){const e=document.createElement("input");return e.classList.add("new-project-input"),e.placeholder="Project Name",e.addEventListener("keyup",d),e}(),r=function(){const e=document.createElement("div");return e.innerText="＋",e.classList.add("aside-element-text"),e.addEventListener("click",c),e}(),a=function(){const e=document.createElement("li");return e.append(r),e}();function c(e){e.target.parentElement.replaceChild(n,e.target),n.value="",n.focus()}function d(e){const t=e.key,n=e.target.value;"Enter"===t&&0!==n.length&&o("checkNewProject",n)}class s{constructor(){this.dateFormatter=p("dateManager")}generateTodoDate(e){const t=document.createElement("p");return t.innerText=this.dateFormatter.giveFormat(e,"d-m-y"),t.addEventListener("click",this.#e(this)),t}#e(e){return function(){const t=this.innerText,o=e.dateFormatter.giveFormat(t,"y-m-d"),n=e.#t(o);this.parentElement.replaceChild(n,this),n.focus()}}#t(e){const t=document.createElement("input");return t.classList.add("date-input"),t.addEventListener("focusout",this.#o),t.type="date",t.value=e,t}#o(e){const t=e.target.parentElement.firstChild,n=t.innerText||t.value,r=e.target.value.split("-").reverse().join("-");o("updateDate",{project:p("getProjectName")(),todo:n,date:r})}}t("projectChanged",(function(e){i=e}));let i=null;const u={};function l(e,t){u[e]=t}function p(e){return u[e]}l("projectElementFactory",new class{build(e){const t=document.createElement("li"),o=this.#n(e),n=this.#r(e);return t.classList.add("project-aside-element"),t.append(o),t.append(n),t}#n(e){const t=document.createElement("p");return t.innerText=e,t}#r(e){const t=document.createElement("span");return t.addEventListener("click",this.#a(e)),t.innerText="x",t.classList.add("delete-project-button"),t}#a(e){return function(){o("deleteProject",e)}}}),l("dateManager",new class{constructor(){this.today=new Date}getDayOfMoths(){return[31,28,31,30,31,30,31,31,30,31,30,31]}getTodayDate(){const e=this.today.getFullYear(),t=this.today.getMonth()+1,o=t<10?`0${t}`:t,n=this.today.getDate();return`${n<10?`0${n}`:n}-${o}-${e}`}giveFormat(e,t){let o=t;const n=e.split("-");return o=o.replace("d",n[0]),o=o.replace("m",n[1]),o=o.replace("y",n[2]),o}getDateWith(e){const t=e.split("-").reverse().join("-");return new Date(t)}getFirstDayWeek(){const e=this.today.getMonth()+1,t=this.today.getFullYear();return`${this.today.getDate()-this.today.getDay()+1}-${e}-${t}`}getLastDayWeek(){let e=this.today.getMonth()+1;const t=this.today.getFullYear(),o=this.today.getDate(),n=(this.today.getDay(),(o+6)%this.getDayOfMoths()[e]);return n<o&&e++,`${n}-${e}-${t}`}}),l("getProjectName",(function(){return i})),l("newTodoButton",new class{build(e){return this.newTodoButton=this.#c(e),this.newTodoButton}#c(e){const t=document.createElement("button");return t.innerText="＋",t.classList.add("new-todo-button"),t.addEventListener("mouseup",this.#d(e,this)),t}#d(e,t){return function(o){const n=o.target.parentElement,r=t.#s(e);n.replaceChild(r,t.newTodoButton)}}#s(e){return p("newTodoFactory").build(e)}}),l("todoFactory",new class{constructor(){this.todoDateFactory=new s}build(e){const t=this.#i(),o=this.#u(e.name),n=this.todoDateFactory.generateTodoDate(e.date),r=this.#l();return t.append(o),t.append(n),t.append(r),t}#l(){const e=document.createElement("button");return e.innerText="x",e.classList.add("delete-todo-button"),e.addEventListener("click",this.#p),e}#p(e){const t=e.target.parentElement.firstChild.innerText;o("removeTodo",{project:p("getProjectName")(),todo:t})}#u(e){const t=document.createElement("p");return t.innerText=e,t.classList.add("todo-name"),t.addEventListener("click",this.#e.bind(this)),t}#e(e){const t=e.target.innerText,o=this.#t(t);o.placeholder="New Todo Name",e.target.parentElement.replaceChild(o,e.target),o.focus()}#i(){const e=document.createElement("div");return e.classList.add("todo-element"),e}setProjectName(e){this.projectName=e}#t(e){const t=document.createElement("input");return t.value=e,t.classList.add("todo-input"),t.addEventListener("keydown",this.#m.bind({todoObject:this,inputValue:e})),t}#m(e){if("Enter"===e.key){const t=e.target.value;o("todoChange",{project:this.todoObject.projectName,oldTodoName:this.inputValue,newTodoName:t})}}}),l("newTodoFactory",new class{build(e){const t=document.createElement("input");return t.id="new-todo-input",t.placeholder="Todo Name",t.addEventListener("keyup",this.#m(e)),t}#m(e){return function(t){const n=t.key,r=t.target.value;"Enter"===n&&o("newTodo",{project:e,todo:r})}}}),l("newProjectButton",a),l("projectCardFactory",new class{build(e){const t=document.createElement("div"),o=this.#h(e.name),n=this.#T(e.todoList);return t.classList.add("project-card"),t.append(o),t.append(n),t}#h(e){const t=document.createElement("h4");return t.innerText=e,t}#T(e){const t=document.createElement("ul");return t.classList.add("todo-list-element"),e.forEach((e=>{const o=this.#g(e.name);t.append(o)})),t}#g(e){const t=document.createElement("li");return t.innerText=e,t}}),t("newProject",j),t("projectsUpdated",j),t("displayNewProjectButton",g);const m=p("newProjectButton"),h=document.querySelector(".project-list"),T=p("projectElementFactory");function g(){h.append(m)}function j(e){h.innerHTML="",e.forEach((e=>{const t=T.build(e);h.append(t)})),g()}h.addEventListener("click",(function(e){"P"===e.target.nodeName&&o("renderProject",e.target.innerText)}));class f{constructor(e){this.name=e,this.date=p("dateManager").getTodayDate()}between(e,t){const o=p("dateManager"),n=o.getDateWith(e).getTime(),r=o.getDateWith(t).getTime(),a=o.getDateWith(this.date).getTime();return n<=a&&a<=r}}class y{constructor(e,t){this.name=e,this.todoList=t}checkName(e){return this.name===e}updateTodo(e){const t=this.getTodo(e.oldTodoName);this.updateExitedTodo(t,e)}getTodo(e){return this.todoList.find((t=>t.name===e))}createNewTodo(e){this.todoList.push(new f(e))}updateExitedTodo(e,t){e.name=t.newTodoName}changeTodoDate(e,t){this.getTodo(e).date=t}removeTodo(e){const t=this.todoList.findIndex((t=>t.name===e));this.todoList.splice(t,1)}filterTodos(e,t){return{name:this.name,todoList:this.todoList.filter((o=>o.between(e,t)))}}}t("saveProjects",(function(e){const t=JSON.stringify(e);localStorage.setItem("projects",t)}));let P=[];t("checkNewProject",(function(e){!function(e){return P.map((e=>e.name)).includes(e)}(e)?(function(e){const t=new y(e,[]);P.push(t),o("saveProjects",P)}(e),w("newProject"),o("renderProject",e)):o("duplicateProject",e)})),t("projectChanged",(function(e){o("renderTodos",v(e).todoList)})),t("todoChange",(function(e){const t=v(e.project);void 0===t.getTodo(e.newTodoName)?(t.updateTodo(e),o("renderProject",e.project),o("saveProjects",P)):alert("Todo Already Exits")})),t("newTodo",(function(e){const t=e.project,n=e.todo,r=v(t);void 0===r.getTodo(n)?(function(e,t){e.createNewTodo(t),o("renderProject",e.name)}(r,n),o("saveProjects",P)):alert("Todo Already Exits")})),t("updateDate",(function(e){v(e.project).changeTodoDate(e.todo,e.date),o("renderProject",e.project),o("saveProjects",P)})),t("removeTodo",(function(e){const t=e.project;v(t).removeTodo(e.todo),o("renderProject",t),o("saveProjects",P)})),t("deleteProject",(function(e){const t=P.findIndex((t=>t.name===e));P.splice(t,1),w("projectsUpdated");const n=P[0];void 0===n?o("renderTodayTodos",{text:"Today",projectsList:null}):o("renderProject",n.name),o("saveProjects",P)})),t("getTodayTodos",(function(e){o("renderTodayTodos",{text:e,projectsList:E[e]()})})),t("loadProjects",(function(e){P=e,w("projectsUpdated")}));const E={Today:function(){const e=p("dateManager").getTodayDate();return this.getProject(e,e)},Week:function(){const e=p("dateManager"),t=e.getFirstDayWeek(),o=e.getLastDayWeek();return this.getProject(t,o)},getProject:function(e,t){return P.map((o=>o.filterTodos(e,t))).filter((e=>e.todoList.length>0))}};function w(e){o(e,P.map((e=>e.name)))}function v(e){return P.find((t=>t.checkName(e)))}const L=document.querySelector("h2"),N=document.querySelector(".todo-section"),D=p("todoFactory");t("renderProject",(function(e){D.setProjectName(e),L.innerText=e,o("projectChanged",e)})),t("renderTodos",(function(e){const t=L.innerText,o=p("newTodoButton").build(t);N.innerHTML="",e.forEach((e=>{const t=D.build(e);N.append(t)})),N.append(o)})),document.querySelector(".timed-option").addEventListener("click",(function(e){"P"===e.target.nodeName&&o("getTodayTodos",e.target.innerText)})),t("renderTodayTodos",(function(e){const t=e.projectsList;if(x.innerText=e.text,k.innerHTML="",null!==t){const e=p("projectCardFactory");t.forEach((t=>{const o=e.build(t);k.append(o)}))}}));const x=document.querySelector("h2"),k=document.querySelector(".todo-section");t("duplicateProject",(function(e){alert(`Project ${e} already exist`)})),t("emptyProjectName",(function(){alert("Project name is empty")})),0!==localStorage.length?o("loadProjects",JSON.parse(localStorage.getItem("projects")).map((e=>new y(e.name,e.todoList.map((e=>new f(e.name))))))):o("displayNewProjectButton",null)})();